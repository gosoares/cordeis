\documentclass[a6paper,10pt]{book}

% Set font size based on font scale
$if(fontscale)$
\usepackage{scalefnt}
\scalefont{$fontscale$}
$endif$

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{microtype} % Optimizes text fitting
\usepackage{graphicx}
\usepackage[paperwidth=105mm, paperheight=148mm, margin=8mm, marginparsep=0mm, marginparwidth=0mm, footskip=8mm]{geometry} % Reduced margins for more content, footskip adjusted for page number positioning
\usepackage{fancyhdr}
\usepackage{etoolbox}
\usepackage{setspace}
\usepackage{xcolor}
\usepackage{parskip}

% Define cordel typography style
\renewcommand*\familydefault{\rmdefault} % Using a serif font for cordelian style
\setstretch{0.95} % Reduce line spacing within stanzas
\setlength{\parindent}{0pt} % Remove first line indentation
\setlength{\parskip}{9pt} % Add space between paragraphs (stanzas) - reduced to 60% of previous value (15pt * 0.6 = 9pt)

% Improve justification for cordel style
\raggedright % Traditional cordel uses ragged right alignment
\hyphenpenalty=5000 % Reduce hyphenation
\tolerance=1000

\fancypagestyle{cordel}{
  \fancyhf{}
  \fancyfoot[C]{\raisebox{6mm}{\normalfont\normalcolor\thepage}} % Move page number up with better formatting
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
  \fancyfootoffset{0pt} % Ensure footer is within page margins
}

% Remove page number from specific pages
\fancypagestyle{empty}{
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

% Define decorative elements typical of cordel literature
\newcommand{\cordelornament}{%
  \begin{center}
    {\Large ✿❁✿❁✿}
  \end{center}
}

\newcommand{\cordelline}{%
  \begin{center}
    \rule{0.5\textwidth}{0.4pt}
  \end{center}
}

% Redefine the pagebreak command to properly handle the horizontal rules (---)
\AtBeginDocument{
  \let\oldpagebreak\pagebreak
  \renewcommand{\pagebreak}{
    \cordelornament
    \clearpage % Force a hard page break
  }
}

% Disable automatic page breaking within stanzas
\widowpenalty=10000
\clubpenalty=10000
\raggedbottom % Better control over page breaks


% Beginning of document
\begin{document}

% Cover page with no margins
\thispagestyle{empty}
$if(cover)$
  \newgeometry{margin=0pt}
  \includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio=false]{content/$cordel_dir$/$cover.image$}
  \clearpage
  \restoregeometry
$else$
  \vspace*{\fill}
  \begin{center}
    {\Huge \textbf{$title$}}\\[1.5cm]
    {\Large \textbf{Manoel Ribeiro}}
    \vspace{1cm}
    \cordelornament
  \end{center}
  \vspace*{\fill}
  \clearpage
$endif$

% Start the cordel content with proper page numbering
\pagestyle{cordel}
\setcounter{page}{1}

% Main content
$body$

% Author information
\clearpage
\thispagestyle{empty}
\vspace*{\stretch{1}}
\begin{center}
  \LARGE \textbf{Manoel Ribeiro}\\[0.5cm]
  \large Lucena - PB\\
  \large (83) 999172122\\
  \large @poetamanoeldocordelpb\\
  \large https://cordeis.gosoares.com\\
  $if(date)$
  \large $date$\\
  $endif$
  \cordelornament
\end{center}
\vspace*{\stretch{2}}

\end{document}
